<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FPL Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background: #2e3b55;
      color: white;
      padding: 1rem;
    }
    main {
      padding: 2rem;
    }
    form {
      margin-bottom: 2rem;
    }
    input[type="text"] {
      padding: 0.5rem;
      font-size: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: #2e3b55;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #1c2536;
    }
    .results {
      text-align: left;
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .player {
      padding: 0.5rem;
      border-bottom: 1px solid #ddd;
    }
    .player:last-child {
      border-bottom: none;
    }
    .suggestion {
      background: #f0f8ff;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <header>
    <h1>FPL Assistant</h1>
    <p>Your Fantasy Premier League Team Analyzer</p>
  </header>

  <main>
    <form id="teamForm">
      <label for="team_id">Enter FPL Team ID:</label>
      <input type="text" id="team_id" name="team_id" required>
      <button type="submit">Analyze</button>
    </form>

    <div id="output" class="results"></div>
  </main>

  <script>
    document.getElementById("teamForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const teamId = document.getElementById("team_id").value;
      const output = document.getElementById("output");
      output.innerHTML = "<p>Loading...</p>";

      try {
        const res = await fetch(`/my_team_analysis?team_id=${teamId}`);
        const data = await res.json();

        if (data.error) {
          output.innerHTML = `<p style="color:red;">Error: ${data.error}</p>`;
          return;
        }

        let html = "<h2>Squad</h2>";
        data.squad.forEach(p => {
          const pos = {1: "GK", 2: "Def", 3: "Mid", 4: "Fwd"}[p.position] || "?";
          html += `
            <div class="player">
              <strong>${p.name}</strong> (${pos}, ${p.team}) â€“ Â£${p.now_cost}m, ${p.points_last_season} pts
            </div>
          `;
        });

        if (data.suggestions && data.suggestions.length > 0) {
          html += "<h2>Suggested Transfers</h2>";
          data.suggestions.forEach(s => {
            html += `
              <div class="suggestion">
                <p><strong>Out:</strong> ${s.out.name} (${s.out.team})</p>
                <p><strong>In:</strong></p>
                <ul>
                  ${s.in.map(r => `<li>${r.name} (${r.team}) â€“ Â£${r.now_cost}m, ${r.points_last_season} pts</li>`).join("")}
                </ul>
              </div>
            `;
          });
        } else {
          html += "<h2>No transfer suggestions right now ðŸŽ‰</h2>";
        }

        output.innerHTML = html;
      } catch (err) {
        output.innerHTML = `<p style="color:red;">Error fetching team data</p>`;
      }
    });
  </script>
</body>
</html>
