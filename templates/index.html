<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FPL Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6 flex items-center">
    <span class="mr-2">⚽</span> FPL Assistant
  </h1>

  <!-- Input Form -->
  <div class="w-full max-w-md bg-white shadow-md rounded-lg p-6">
    <label for="teamId" class="block text-lg font-medium mb-2">Enter FPL Team ID:</label>
    <input id="teamId" type="text" class="w-full border rounded p-2 mb-4" placeholder="e.g., 656120" />
    <button id="analyzeBtn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
      Analyze
    </button>
  </div>

  <!-- Results -->
  <div id="results" class="w-full max-w-3xl mt-8"></div>

  <script>
    document.getElementById("analyzeBtn").addEventListener("click", () => {
      const teamId = document.getElementById("teamId").value;
      const resultDiv = document.getElementById("results");
      resultDiv.innerHTML = "<p class='text-gray-500'>Analyzing...</p>";

      fetch(`/my_team_analysis?team_id=${teamId}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            resultDiv.innerHTML = `<p class="text-red-500">Error: ${data.error}</p>`;
            return;
          }

          let html = "<h2 class='text-2xl font-bold mb-4'>Your Squad</h2>";

          // Squad grouped by position
          for (const [pos, players] of Object.entries(data.squad)) {
            html += `<h3 class="text-xl font-semibold mt-6">${pos}</h3><ul class="list-disc ml-6">`;
            players.forEach(p => {
              html += `<li>${p.web_name} (${p.team}) — £${p.now_cost/10}m, Points: ${p.total_points}</li>`;
            });
            html += "</ul>";
          }

          // Suggested transfers
          if (data.suggested_transfers && data.suggested_transfers.length > 0) {
            html += "<h2 class='text-2xl font-bold mt-8'>Suggested Transfers</h2><ul class='list-disc ml-6'>";
            data.suggested_transfers.forEach(t => {
              html += `<li>Out: <strong>${t.out}</strong> → In: <strong>${t.in}</strong> (${t.in_team}) — Points: ${t.points}, Cost: £${t.cost}m</li>`;
            });
            html += "</ul>";
          } else {
            html += "<p class='mt-6 text-gray-600'>No transfer suggestions (your squad looks solid!).</p>";
          }

          resultDiv.innerHTML = html;
        })
        .catch(err => {
          resultDiv.innerHTML = `<p class="text-red-500">Error: ${err.message}</p>`;
        });
    });
  </script>
</body>
</html>
