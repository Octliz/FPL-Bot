<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FPL Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center">‚öΩ FPL Assistant</h1>

    <!-- Input Form -->
    <form id="teamForm" class="flex justify-center mb-8">
      <input type="text" id="teamId" placeholder="Enter your FPL Team ID"
             class="border rounded-l px-4 py-2 w-64">
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-r hover:bg-blue-700">
        Analyze
      </button>
    </form>

    <!-- Results -->
    <div id="results" class="space-y-8"></div>
  </div>

  <script>
    document.getElementById("teamForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const teamId = document.getElementById("teamId").value;
      const res = await fetch(`/my_team_analysis?team_id=${teamId}`);
      const data = await res.json();

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (data.error) {
        resultsDiv.innerHTML = `<p class="text-red-600">${data.error}</p>`;
        return;
      }

      // --- TEAM ANALYSIS ---
      let teamHtml = `<h2 class="text-2xl font-semibold mb-4">Your Squad</h2>
                      <div class="grid md:grid-cols-3 gap-6">`;

      data.team_analysis.forEach(p => {
        const fixtures = p.fixtures.map(f => `<li>${f}</li>`).join("");
        teamHtml += `
          <div class="bg-white p-4 rounded-lg shadow">
            <h3 class="font-bold text-lg">${p.name} (${p.team_name})</h3>
            <p class="text-gray-700">üí∞ ${p.cost}m | ‚≠ê ${p.total_points} pts</p>
            <h4 class="mt-2 font-semibold">Next Fixtures:</h4>
            <ul class="list-disc list-inside text-sm text-gray-600">${fixtures}</ul>
          </div>`;
      });

      teamHtml += `</div>`;
      resultsDiv.innerHTML += teamHtml;

      // --- SUGGESTED TRANSFERS ---
      let transferHtml = `<h2 class="text-2xl font-semibold mb-4 mt-8">Suggested Transfers</h2>
                          <div class="space-y-6">`;

      data.suggested_transfers.forEach(tr => {
        let inPlayers = tr.in.map(p => {
          const fixtures = p.fixtures.map(f => `<li>${f}</li>`).join("");
          return `
            <div class="bg-green-50 p-3 rounded-lg shadow-sm">
              <p class="font-bold">${p.name} (${p.team_name})</p>
              <p class="text-gray-700">üí∞ ${p.cost}m | ‚≠ê ${p.total_points} pts</p>
              <ul class="list-disc list-inside text-sm text-gray-600">${fixtures}</ul>
            </div>`;
        }).join("");

        const outFixtures = tr.out_fixtures.map(f => `<li>${f}</li>`).join("");

        transferHtml += `
          <div class="bg-white p-4 rounded-lg shadow">
            <p class="font-semibold text-red-600">Out: ${tr.out}</p>
            <ul class="list-disc list-inside text-sm text-gray-600 mb-2">${outFixtures}</ul>
            <div class="grid md:grid-cols-2 gap-4">
              ${inPlayers}
            </div>
          </div>`;
      });

      transferHtml += `</div>`;
      resultsDiv.innerHTML += transferHtml;
    });
  </script>
</body>
</html>
